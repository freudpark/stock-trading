# 주식 자동매매 시스템 최종 사용자 매뉴얼 및 운영 가이드

## 1. 시스템 개요

본 시스템은 사용자님께서 정의하신 **뉴스 기반 복합 매매 전략**을 **n8n**과 **Python**을 결합하여 자동화한 하이브리드 자동매매 시스템입니다.

- **목표:** 매일 오전 9시에 자동으로 종목을 선정하고, 매매를 실행하며, 그 결과를 Google Sheets 대시보드에 기록합니다.
- **거래소:** 한국투자증권 Open API 기반으로 설계되었습니다.

---

## 2. 시스템 구성 요소 및 역할

| 구성 요소 | 역할 | 상세 설명 |
| :--- | :--- | :--- |
| **Python Flask API** | 핵심 로직 실행 서버 | 뉴스 수집, 감성 분석, 종목 선정, 전문가 기법 점수화, 매매 판단, 주문 실행 (모의)을 담당합니다. |
| **n8n 워크플로우** | 자동화 오케스트레이터 | Cron 스케줄링, API 호출, 데이터 필터링, 반복 처리, Google Sheets 연동을 담당합니다. |
| **Google Sheets** | 투자 결과 대시보드 | 매매 로그, 포트폴리오 현황, 수익률 추이를 실시간으로 모니터링합니다. |
| **한국투자증권 API** | 실제 주문 실행 | 주문, 잔고 조회, 체결 내역 확인 등 실제 거래소 연동을 담당합니다. |

---

## 3. 시스템 설치 및 초기 설정 (3단계)

### 3-1. Python 환경 설정 및 API 서버 실행

1. **필수 라이브러리 설치:**
   ```bash
   pip3 install requests beautifulsoup4 pandas konlpy flask
   ```

2. **API 서버 실행:**
   - `app.py` 파일이 있는 디렉토리에서 다음 명령어로 서버를 백그라운드에서 실행합니다.
   ```bash
   nohup python3 /home/ubuntu/app.py > /home/ubuntu/flask_log.txt 2>&1 &
   ```
   - **주의:** 이 서버는 **24시간 구동**되어야 합니다. 영구적인 운영을 위해서는 AWS, GCP 등 외부 클라우드 서버에 배포해야 합니다.

3. **API URL 확인:**
   - 현재 테스트 환경의 URL은 `https://5000-iy02ypbvf4a067ni5wwoi-c28ca08f.manus-asia.computer` 입니다. **실제 배포 시에는 이 URL을 변경해야 합니다.**

### 3-2. Google Sheets 대시보드 설정

1. **스프레드시트 생성:**
   - [Google Sheets](https://sheets.google.com)에서 새 파일을 만들고 파일명을 **"자동매매 투자 대시보드"**로 지정합니다.
   - **`google_sheets_setup_guide.md`** 문서를 참고하여 **"대시보드", "매매 로그", "보유 종목", "수익률 추이"** 시트의 헤더 및 기본 공식을 설정합니다.

2. **n8n 연동 권한 설정:**
   - Google Sheets 파일의 **공유 권한**을 n8n에서 사용할 Google 계정에 **편집자** 권한으로 부여합니다.

### 3-3. n8n 워크플로우 설정

1. **n8n 실행:**
   ```bash
   n8n start
   ```

2. **워크플로우 가져오기 및 설정:**
   - **`n8n_workflow_guide.md`** 문서를 참고하여 워크플로우를 생성합니다.
   - **Cron 트리거:** 매일 오전 9시로 설정 (`0 9 * * *`)
   - **HTTP Request 노드:** API URL을 **실제 배포된 서버의 URL**로 변경합니다.
   - **Google Sheets 노드:** Google 계정을 인증하고, **"자동매매 투자 대시보드"** 파일을 선택합니다.

---

## 4. 매매 판단 로직 (전문가 기법 점수화)

시스템은 다음 6가지 단계를 거쳐 종목을 선정하고 매수 판단을 내립니다.

### 4-1. 종목 선정 및 분석 (Python)

1. **뉴스 기반 분야 추출:** 긍정적인 키워드(성장, 기술, 혁신 등)를 분석하여 관련 분야 추출.
2. **후보 종목 선정:** 추출된 분야의 시가총액 상위 5개 종목을 후보군으로 선정.
3. **재무/기술 분석:** 각 종목에 대해 8가지 핵심 지표 분석 (ROE, 부채비율, RSI, MACD 등).

### 4-2. 전문가 기법 점수화 (총 9점 만점)

| 전문가 | 기법 | 점수 | 매수 판단 기준 |
| :--- | :--- | :--- | :--- |
| **워렌 버핏** | 가치 투자 | 2점 | ROE 15% 이상, 부채비율 100% 이하 |
| **피터 린치** | 성장주 투자 | 2점 | EPS 성장률 10% 이상 |
| **제시 리버모어** | 추세 매매 | 3점 | BB 상단돌파직전, 거래량 1.5배 이상 |
| **기술적 우위** | 보조 지표 | 2점 | 이평선 정배열, RSI 70 이하 |

### 4-3. 최종 매매 결정

- **매수 결정:** **총 점수 4점 이상**인 종목만 매수 대상으로 선정.
- **투자 금액:** 총 투자금액(기본 1,000만 원)의 **1/3**을 분할 매수.
- **목표가:** 매수 가격 대비 **+5%** 수익률.

---

## 5. 운영 및 모니터링

### 5-1. 시스템 자동 실행

- 매일 오전 9시에 n8n 워크플로우가 자동으로 실행됩니다.
- 실행 후 약 1~2분 내에 종목 선정 및 주문 실행이 완료됩니다.

### 5-2. 대시보드 모니터링

- **Google Sheets**를 열어 **"대시보드"** 시트에서 핵심 지표를 확인합니다.
- **"매매 로그"** 시트에서 당일의 주문 내역과 선정 이유를 확인합니다.
- **"보유 종목"** 시트에서 현재 포트폴리오의 실시간 손익을 확인합니다.

### 5-3. 로그 확인 및 트러블슈팅

| 문제 상황 | 확인 사항 | 해결 방안 |
| :--- | :--- | :--- |
| **자동 실행 안됨** | n8n 워크플로우 활성화 여부 | 워크플로우를 활성화하고, Cron 설정(오전 9시) 확인 |
| **API 호출 에러** | Flask 서버 구동 여부 | `nohup` 프로세스 확인 및 재실행 |
| **Google Sheets 에러** | n8n의 Google Sheets 노드 인증 | Google 계정 인증을 재설정하고, 파일 ID 및 시트 이름 확인 |
| **뉴스 수집 실패** | 네이버 뉴스 웹사이트 구조 변경 | `stock_selector.py`의 뉴스 수집 로직 수정 |

---

## 6. 실제 거래소 연동 가이드

현재 시스템은 **모의 환경**에서 작동합니다. 실제 주문을 위해서는 다음 단계를 따라야 합니다.

1. **한국투자증권 Open API 신청:**
   - 한국투자증권 개발자 포털에서 API 사용 신청 (실전/모의 선택).

2. **API 키 설정:**
   - 발급받은 **App Key**와 **App Secret**을 Flask 서버가 실행되는 환경에 **환경 변수**로 설정합니다.
   - **주의:** `app.py` 파일 내부에 직접 키를 입력하지 마세요.

3. **주문 로직 구현:**
   - `app.py`의 `execute_trade` 함수 내부에 있는 모의 주문 코드를 **실제 KIS API 주문 호출 코드**로 대체합니다.
   - **권장:** 먼저 **모의투자 계좌**에 연동하여 1주일 이상 테스트를 진행한 후 실전으로 전환하세요.

---

## 7. 최종 산출물 목록

| 파일명 | 설명 |
| :--- | :--- |
| `SYSTEM_IMPLEMENTATION_REPORT.md` | 시스템 구현 완료 보고서 (전체 요약) |
| `USER_MANUAL.md` | 최종 사용자 매뉴얼 및 운영 가이드 (현재 문서) |
| `kis_api_analysis.md` | 한국투자증권 API 분석 |
| `n8n_workflow_guide.md` | n8n 워크플로우 설계 가이드 |
| `google_sheets_setup_guide.md` | Google Sheets 대시보드 설정 가이드 |
| `stock_selector.py` | 핵심 분석 및 매매 판단 Python 스크립트 |
| `app.py` | Flask API 서버 스크립트 |
| `dashboard_manager.py` | 대시보드 관리 Python 모듈 |
| `dashboard_data.json` | 대시보드 데이터 샘플 |

---

**이것으로 자동매매 시스템 구축의 모든 단계를 완료했습니다.**

이제 사용자님께서는 이 매뉴얼을 바탕으로 시스템을 설치하고 운영하실 수 있습니다. 최종적으로 이 모든 산출물을 전달해 드리겠습니다.
